<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>속기사 화면</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    body { font-family: "Malgun Gothic","맑은 고딕",sans-serif; background:#f0f4f8; padding:40px; }
    h2 { font-size:1.8rem; }
    textarea {
      width: 90%; height: 60vh;
      font-family: "Malgun Gothic","맑은 고딕",sans-serif;
      font-size: 2rem; line-height: 1.6;
      padding: 20px; border-radius: 15px; border: 2px solid #aaa;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1); resize: none; background: #fff;
    }
  </style>
</head>
<body>
  <h2>속기사 입력창</h2>
  <textarea id="input" placeholder="입력 후 스페이스/엔터를 누르면 시청자 화면에 즉시 반영됩니다."></textarea>

  <script>
    const socket = io();
    const input = document.getElementById('input');

    let composing = false;

    // 한글 IME 조합 상태 추적
    input.addEventListener('compositionstart', () => { composing = true; });
    input.addEventListener('compositionend',   () => { composing = false; });

    // ✅ 스페이스/엔터를 "확정"하는 타이밍: keyup이 IME에 더 안전
    input.addEventListener('keyup', (e) => {
      if (composing) return;

      if (e.key === 'Enter' || e.key === ' ' || e.key === 'Spacebar') {
        // 현재까지 입력된 전체 텍스트를 그대로 전송
        socket.emit('full_text', input.value);
      }
    });
  </script>
</body>
</html>